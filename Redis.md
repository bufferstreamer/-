# NoSql

![](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422224507385.png)	

![image-20220422224908951](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422224908951.png)

# Redis

![image-20220422225527035](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422225527035.png)

## 数据结构

![image-20220422230753658](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422230753658.png)

## 通用命令

![image-20220422231837903](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422231837903.png)

## String

![image-20220422232107534](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422232107534.png)

![image-20220422232553157](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422232553157.png)

![image-20220422233013558](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422233013558.png)

## hash

![image-20220422233145305](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422233145305.png)

![image-20220422233202578](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422233202578.png)

## List

![image-20220422233538050](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422233538050.png)

![image-20220422233612708](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422233612708.png)

## Set

![image-20220422234457279](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422234457279.png)

![image-20220422234611294](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422234611294.png)

![image-20220422234655188](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422234655188.png)

## SortedSet

![image-20220422235255938](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422235255938.png)

![](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220422235502696.png)

# Redis的JAVA客户端

![image-20220423000257806](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220423000257806.png)

## Jedis

![image-20220429161207255](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429161207255.png)

## jedis连接池

![image-20220429161233038](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429161233038.png)

## springDataRedis

![image-20220429161530129](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429161530129.png)

![image-20220429162016608](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429162016608.png)

### 快速入门

![image-20220429162046157](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429162046157.png)

![image-20220429162956226](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429162956226.png)

![image-20220429162246550](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220429162246550.png)

### StringRedisTemplate

![image-20220430145313541](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430145313541.png)

![image-20220430150335622](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430150335622.png)

![image-20220430150532245](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430150532245.png)

![image-20220430150613353](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430150613353.png)

# 案例演示

![image-20220430164225507](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430164225507.png)

 ![image-20220430170649203](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430170649203.png)

## 登录

![image-20220430172953085](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220430172953085.png)

## 商户缓存

![image-20220502143441951](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502143441951.png)

![image-20220502143728162](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502143728162.png)

![image-20220502144656103](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502144656103.png)

## 缓存更新

![image-20220502160514912](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502160514912.png)

![image-20220502160824325](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502160824325.png)

![image-20220502161216424](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502161216424.png)

![](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502161756644.png)

![image-20220502161819679](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502161819679.png)

## 缓存穿透

![](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502163601086.png)

## 缓存雪崩

![image-20220502170419737](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502170419737.png)

## 缓存击穿

![image-20220502170710567](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502170710567.png)

![image-20220502171206735](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502171206735.png)

![image-20220502171340523](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220502171340523.png)

## 优惠券秒杀

![image-20220504174435039](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504174435039.png)

![image-20220504160156844](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504160156844.png)

![image-20220504175624907](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504175624907.png)

## 超卖问题

![image-20220504180537408](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504180537408.png)

![image-20220504180828289](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504180828289.png)

![image-20220504181550923](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504181550923.png)

![image-20220504181604410](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220504181604410.png)

## 集群情况

![image-20220505161631219](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505161631219.png)

为了解决不同jvm之间使用同一个锁监视器的情况 需要用到分布式锁

## 分布式锁

![image-20220505204833716](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505204833716.png)

 

![image-20220505205337083](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505205337083.png)

![image-20220505205831972](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505205831972.png)

## 误删锁问题

![image-20220505212029994](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505212029994.png)

根本原因是自己线程阻塞后，自己的锁由于超时自动释放了，当自己业务完成时删除了别人的锁，导致其他线程在这段时间内可以再获得锁

## 解决办法

![image-20220505212820419](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505212820419.png)

## 误删锁问题2

![image-20220505213303932](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505213303932.png)

根本原因是判断锁是不是自己的和删除锁两个动作是独立的 假如判断成功后发生阻塞至该锁过期，则会出现并发问题

## 解决办法（保证判断和删除的原子性）

![](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505213744655.png)

![image-20220505214139572](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505214139572.png)

![image-20220505214522944](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505214522944.png)

![image-20220505214615523](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505214615523.png)

## 存在的问题

![image-20220505225407478](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505225407478.png)

![image-20220506155613043](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506155613043.png)

## 解决办法——Redisson

![image-20220505225732021](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505225732021.png)

![image-20220505225805758](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505225805758.png)

![image-20220505225929587](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505225929587.png)

## Redisson可重入锁原理

![image-20220505232524796](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505232524796.png)

![image-20220505232747573](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505232747573.png)

![image-20220505232736237](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220505232736237.png)

## Redisson分布式可重试锁原理

![image-20220506155453964](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506155453964.png)

## Redisson分布式主从一致锁原理

![image-20220506160117220](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506160117220.png)

## 总结

![image-20220506161430175](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506161430175.png)

## 秒杀优化

![image-20220507203121616](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507203121616.png)

![image-20220506174134932](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506174134932.png)

![image-20220506174623375](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220506174623375.png)

## 消息队列

![image-20220507203646276](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507203646276.png)

### List

![image-20220507204039972](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507204039972.png)

![image-20220507204158296](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507204158296.png)

### pubsub

![image-20220507204529532](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507204529532.png)

![image-20220507204814680](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507204814680.png)

### stream

![image-20220507205400601](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507205400601.png)

![image-20220507210026818](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507210026818.png)

![image-20220507210243585](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507210243585.png)

![image-20220507210351107](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507210351107.png)

### 消费者组

![image-20220507211049187](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507211049187.png)

![image-20220507211309587](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507211309587.png)

![image-20220507211612740](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507211612740.png)

![image-20220507212456687](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507212456687.png)

### 总结

![image-20220507212511166](C:/Users/%E5%88%98%E6%80%BC%E6%80%BC/AppData/Roaming/Typora/typora-user-images/image-20220507212511166.png)
